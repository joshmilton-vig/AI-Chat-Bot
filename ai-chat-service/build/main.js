"use strict";var VividAssistant=(()=>{var $=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var V=(e,t)=>{for(var i in t)$(e,i,{get:t[i],enumerable:!0})},_=(e,t,i,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of D(t))!P.call(e,a)&&a!==i&&$(e,a,{get:()=>t[a],enumerable:!(d=j(t,a))||d.enumerable});return e};var R=e=>_($({},"__esModule",{value:!0}),e);var J={};V(J,{mountVividChat:()=>q});async function H(e,t,i,d){let a=await fetch(`${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({business:t,messages:i}),signal:d});if(!a.ok){let h=await a.text().catch(()=>"");throw new Error(`Chat error ${a.status}: ${h||a.statusText}`)}let b=await a.json();return String(b.message??"Sorry \u2014 I couldn\u2019t get a response.")}var N="vivid-chat-style",n="vivid-chat-widget",T="vivid-chat-host",B=null;function M(){let e=document.getElementById(T);return e||(e=document.createElement("div"),e.id=T,e.style.position="fixed",e.style.right="0",e.style.bottom="0",e.style.zIndex="2147483647",document.body.appendChild(e)),B=e.shadowRoot??e.attachShadow({mode:"open"}),{host:e,shadow:B}}function W(){let{shadow:e}=M();if(e.getElementById(N))return;let t=`
  /* Small reset so host styles never bleed in */
  :host, :host * { box-sizing: border-box; }
  :host * { font-family: Verdana, Arial, sans-serif; }

  #${n} { position: fixed; z-index: 2147483647; right: 20px; bottom: 20px; }
  #${n} .bubble { width: 56px; height: 56px; border-radius: 999px; box-shadow: 0 8px 24px rgba(0,0,0,.18); display:flex; align-items:center; justify-content:center; cursor:pointer; background: #111; color:#fff; }
  #${n} .panel { position: absolute; right: 0; bottom: 72px; width: 340px; max-height: 70vh; background: #fff; border-radius: 16px; box-shadow: 0 16px 40px rgba(0,0,0,.25); display:none; flex-direction:column; overflow:hidden; border:1px solid #e5e7eb; }
  #${n} .panel.open { display:flex; }
  #${n} header { padding: 10px 12px; font-weight: bold; border-bottom: 1px solid #f0f0f0; display:flex; align-items:center; justify-content:space-between; }
  #${n} header .brand { font-size: 13px; opacity:.85 }
  #${n} header button { all: unset; cursor:pointer; padding: 6px 8px; border-radius: 8px; }
  #${n} .log { padding: 10px 12px; display:flex; gap:8px; flex-direction:column; overflow:auto; background:#fff; }
  #${n} .msg { font-size: 13px; line-height: 1.35; padding: 8px 10px; border-radius: 10px; max-width: 85%; white-space: pre-wrap; }
  #${n} .msg.user { align-self: flex-end; background:#111; color:#fff; border-top-right-radius: 4px; }
  #${n} .msg.assistant { align-self: flex-start; background:#f6f6f7; color:#111; border-top-left-radius: 4px; }
  #${n} footer { border-top: 1px solid #f0f0f0; padding: 8px; display:flex; gap:6px; background:#fff; }
  #${n} textarea { -webkit-appearance:none; appearance:none; resize:none; flex:1; min-height:40px; max-height:140px; border:1px solid #ddd; border-radius:10px; padding:8px 10px; font-size:13px; background:#fff; color:#111; outline:none; box-shadow:none; }
  #${n} .send { all: unset; display:inline-flex; align-items:center; justify-content:center; background:#111; color:#fff; border-radius:10px; padding: 8px 12px; font-size:13px; cursor:pointer; line-height:1; }
  #${n} .hint { font-size: 11px; color:#6b7280; padding: 6px 12px 10px; background:#fff; }
  #${n} .typing { display:flex; align-items:center; gap:6px; padding:8px 12px; margin:6px 10px; background:#f3f4f6; border-radius:16px; width:fit-content; }
  #${n} .typing span { width:8px; height:8px; background:#6b7280; border-radius:50%; display:inline-block; opacity:.4; animation: vivid-blink 1.2s infinite both; }
  #${n} .typing span:nth-child(2) { animation-delay:.2s; }
  #${n} .typing span:nth-child(3) { animation-delay:.4s; }
  @keyframes vivid-blink { 0%{opacity:.4;} 20%{opacity:1;} 100%{opacity:.4;} }
  `,i=document.createElement("style");i.id=N,i.textContent=t,e.appendChild(i)}function O(e={}){let t=e.apiBase??"/api/ai",i=e.business??F(),d=e.siteName??(document.title||"Vivid Store"),a=!!e.debug,{shadow:b}=M();W();let h=!1,g=document.createElement("div");g.id=n;let u=document.createElement("button");u.className="bubble",u.title="Chat",u.innerHTML=Y();let l=document.createElement("div");l.className="panel";let x=document.createElement("header"),L=document.createElement("div");L.textContent="Prisma Assistant";let v=document.createElement("div");v.className="brand",v.textContent=d;let S=document.createElement("div"),y=document.createElement("button");y.ariaLabel="Close",y.innerHTML="\u2715",S.appendChild(y),x.appendChild(L),x.appendChild(v),x.appendChild(S);let p=document.createElement("div");p.className="log";let c=document.createElement("div");c.className="typing",c.style.display="none",c.innerHTML="<span></span><span></span><span></span>",p.appendChild(c);let w=document.createElement("footer"),f=document.createElement("textarea");f.placeholder="Ask about products, lead times, shipping, etc.";let s=document.createElement("button");s.className="send",s.textContent="Send",w.appendChild(f),w.appendChild(s);let C=document.createElement("div");C.className="hint",C.textContent="No order/account lookups. For payments or existing orders, contact support.",l.appendChild(x),l.appendChild(p),l.appendChild(w),l.appendChild(C),g.appendChild(u),g.appendChild(l),b.appendChild(g);function I(o){h=o,l.classList.toggle("open",h)}u.addEventListener("click",()=>I(!h)),y.addEventListener("click",()=>I(!1));let k=[{role:"system",content:G(d,i)}];async function z(){let o=f.value.trim();if(o){E("user",o),f.value="",s&&(s.disabled=!0),c.style.display="flex";try{let r=await H(t,i,k.concat({role:"user",content:o}));c.style.display="none",s&&(s.disabled=!1),k.push({role:"user",content:o}),k.push({role:"assistant",content:r}),E("assistant",r),A("vivid_chat_message",{role:"assistant"})}catch(r){c.style.display="none",s&&(s.disabled=!1);let m=`Sorry \u2014 I had trouble reaching the assistant. (${r?.message||"Network error"})`;E("assistant",m),a&&console.error(r)}}}s.addEventListener("click",z),f.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),z())});function E(o,r){let m=document.createElement("div");m.className=`msg ${o}`,m.textContent=r,p.appendChild(m),p.scrollTop=p.scrollHeight}function A(o,r){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:o,...r,business:i,siteName:d})}a&&console.log("Chat widget initialized",{apiBase:t,business:i,siteName:d})}function Y(){return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path fill="currentColor" d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM6 9h12v2H6V9zm0-4h12v2H6V5zm0 8h8v2H6v-2z"/></svg>'}function F(){let e=location.hostname.toLowerCase();return e.includes("vividnola")?"vividnola":e.includes("toastedyolk")?"toastedyolk":e.includes("celtic")?"celtic":"vivid"}function G(e,t){return[`You are Prisma storefront assistant for ${e} (business: ${t}).`,"Be helpful, concise, and brand-safe. You cannot access accounts, orders, or payments.","Capabilities: explain products, materials, typical lead times, shipping options, design tips.","Limitations: no PII, no quoting specific prices unless plainly shown on page, no legal/medical advice.","If unsure, offer to escalate to customer service: sales@vividink.com."].join(`
`)}function q(e){let t=e?.apiBase??"https://assistant.vivid-think.com/api/ai",i=()=>O({...e,apiBase:t});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i,{once:!0}):i()}return R(J);})();
