"use strict";var VividAssistant=(()=>{var $=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var A=(e,t)=>{for(var s in t)$(e,s,{get:t[s],enumerable:!0})},O=(e,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of H(t))!j.call(e,i)&&i!==s&&$(e,i,{get:()=>t[i],enumerable:!(o=B(t,i))||o.enumerable});return e};var P=e=>O($({},"__esModule",{value:!0}),e);var F={};A(F,{mountVividChat:()=>Y});async function I(e,t,s,o){let i=await fetch(`${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({business:t,messages:s}),signal:o});if(!i.ok){let c=await i.text().catch(()=>"");throw new Error(`Chat error ${i.status}: ${c||i.statusText}`)}let h=await i.json();return String(h.message??"Sorry \u2014 I couldn\u2019t get a response.")}var M="vivid-chat-style",n="vivid-chat-widget";function V(){if(document.getElementById(M))return;let e=`
  #${n} { position: fixed; z-index: 99999; right: 20px; bottom: 20px; font-family: Verdana, Arial, sans-serif; }
  #${n} .bubble { width: 56px; height: 56px; border-radius: 999px; box-shadow: 0 8px 24px rgba(0,0,0,.18); display:flex; align-items:center; justify-content:center; cursor:pointer; background: #111; color:#fff; }
  #${n} .panel { position: absolute; right: 0; bottom: 72px; width: 340px; max-height: 70vh; background: #fff; border-radius: 16px; box-shadow: 0 16px 40px rgba(0,0,0,.25); display:none; flex-direction:column; overflow:hidden; border:1px solid #e5e7eb; }
  #${n} .panel.open { display:flex; }
  #${n} header { padding: 10px 12px; font-weight: bold; border-bottom: 1px solid #f0f0f0; display:flex; align-items:center; justify-content:space-between; }
  #${n} header .brand { font-size: 13px; opacity:.85 }
  #${n} header button { all: unset; cursor:pointer; padding: 6px 8px; border-radius: 8px; }
  #${n} .log { padding: 10px 12px; display:flex; gap:8px; flex-direction:column; overflow:auto; }
  #${n} .msg { font-size: 13px; line-height: 1.35; padding: 8px 10px; border-radius: 10px; max-width: 85%; white-space: pre-wrap; }
  #${n} .msg.user { align-self: flex-end; background:#111; color:#fff; border-top-right-radius: 4px; }
  #${n} .msg.assistant { align-self: flex-start; background:#f6f6f7; color:#111; border-top-left-radius: 4px; }
  #${n} footer { border-top: 1px solid #f0f0f0; padding: 8px; display:flex; gap:6px; }
  #${n} textarea { resize:none; flex:1; min-height:40px; max-height:140px; border:1px solid #ddd; border-radius:10px; padding:8px 10px; font-size:13px; }
  #${n} .send { background:#111; color:#fff; border:none; border-radius:10px; padding: 0 12px; font-size:13px; cursor:pointer; }
  #${n} .hint { font-size: 11px; color:#6b7280; padding: 6px 12px 10px; }
  #${n} .typing { display:flex; align-items:center; gap:6px; padding:8px 12px; margin:6px 10px; background:#f3f4f6; border-radius:16px; width:fit-content; }
  #${n} .typing span { width:8px; height:8px; background:#6b7280; border-radius:50%; display:inline-block; opacity:.4; animation: vivid-blink 1.2s infinite both; }
  #${n} .typing span:nth-child(2) { animation-delay:.2s; }
  #${n} .typing span:nth-child(3) { animation-delay:.4s; }
  @keyframes vivid-blink { 0%{opacity:.4;} 20%{opacity:1;} 100%{opacity:.4;} }

  `,t=document.createElement("style");t.id=M,t.textContent=e,document.head.appendChild(t)}function S(e={}){let t=e.apiBase??"/api/ai",s=e.business??_(),o=e.siteName??(document.title||"Vivid Store"),i=!!e.debug;V();let h=!1,c=document.createElement("div");c.id=n;let m=document.createElement("button");m.className="bubble",m.title="Chat",m.innerHTML=D();let p=document.createElement("div");p.className="panel";let x=document.createElement("header"),k=document.createElement("div");k.textContent="Prisma Assistant";let y=document.createElement("div");y.className="brand",y.textContent=o;let L=document.createElement("div"),b=document.createElement("button");b.ariaLabel="Close",b.innerHTML="\u2715",L.appendChild(b),x.appendChild(k),x.appendChild(y),x.appendChild(L);let l=document.createElement("div");l.className="log";let u=document.createElement("div");u.className="typing",u.style.display="none",u.innerHTML="<span></span><span></span><span></span>",l.appendChild(u);let v=document.createElement("footer"),f=document.createElement("textarea");f.placeholder="Ask about products, lead times, shipping, etc.";let d=document.createElement("button");d.className="send",d.textContent="Send",v.appendChild(f),v.appendChild(d);let C=document.createElement("div");C.className="hint",C.textContent="No order/account lookups. For payments or existing orders, contact support.",p.appendChild(x),p.appendChild(l),p.appendChild(v),p.appendChild(C),c.appendChild(m),c.appendChild(p),document.body.appendChild(c);function N(a){h=a,p.classList.toggle("open",h)}m.addEventListener("click",()=>N(!h)),b.addEventListener("click",()=>N(!1));let w=[{role:"system",content:W(o,s)}];async function z(){let a=f.value.trim();if(a){E("user",a),f.value="",d&&(d.disabled=!0),u.style.display="flex";try{let r=await I(t,s,w.concat({role:"user",content:a}));u.style.display="none",d&&(d.disabled=!1),w.push({role:"user",content:a}),w.push({role:"assistant",content:r}),E("assistant",r),T("vivid_chat_message",{role:"assistant"})}catch(r){let g=`Sorry \u2014 I had trouble reaching the assistant. (${r?.message||"Network error"})`;E("assistant",g),i&&console.error(r)}}}d.addEventListener("click",z),f.addEventListener("keydown",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),z())});function E(a,r){let g=document.createElement("div");g.className=`msg ${a}`,g.textContent=r,l.appendChild(g),l.scrollTop=l.scrollHeight}function T(a,r){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:a,...r,business:s,siteName:o})}i&&console.log("Chat widget initialized",{apiBase:t,business:s,siteName:o})}function D(){return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path fill="currentColor" d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM6 9h12v2H6V9zm0-4h12v2H6V5zm0 8h8v2H6v-2z"/></svg>'}function _(){let e=location.hostname.toLowerCase();return e.includes("vividnola")?"vividnola":e.includes("toastedyolk")?"toastedyolk":e.includes("celtic")?"celtic":"vivid"}function W(e,t){return[`You are Prisma storefront assistant for ${e} (business: ${t}).`,"Be helpful, concise, and brand-safe. You cannot access accounts, orders, or payments.","Capabilities: explain products, materials, typical lead times, shipping options, design tips.","Limitations: no PII, no quoting specific prices unless plainly shown on page, no legal/medical advice.","If unsure, offer to escalate to customer service: sales@vividink.com."].join(`
`)}function Y(){document.addEventListener("DOMContentLoaded",()=>{S({apiBase:"/api/ai",debug:!1})})}return P(F);})();
